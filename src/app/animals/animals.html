<app-table-title [modelKey]="'model.animal'"></app-table-title>

<app-loading [loading]="loading()">
  <app-table-toolbar
    [enableEdit]="userService.isAdmin()"
    [length]="dataAll().length"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    (pageChange)="onPageChange($event)"
  ></app-table-toolbar>

  <table mat-table [dataSource]="dataPagedSortedFiltered()">
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>#</th>
      <td mat-cell *matCellDef="let animal">
        @if(userService.isAdmin()) {
        <app-table-actions [row]="animal" (delete)="onDelete(animal)"></app-table-actions>
        }
      </td>
    </ng-container>

    <!-- Species -->
    <ng-container matColumnDef="species">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.species' | translate }}</th>
      <td mat-cell *matCellDef="let animal">{{ animal.species }}</td>
    </ng-container>

    <!-- Breed -->
    <ng-container matColumnDef="breed">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.breed' | translate }}</th>
      <td mat-cell *matCellDef="let animal">{{ animal.breed }}</td>
    </ng-container>

    <!-- Birth Date -->
    <ng-container matColumnDef="birthDate">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.birthDate' | translate }}</th>
      <td mat-cell *matCellDef="let animal">
        {{ animal.birthDate | date : dateFormat }}
      </td>
    </ng-container>

    <!-- Birth Date: Age -->
    <ng-container matColumnDef="age">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.age' | translate }}</th>
      <td mat-cell *matCellDef="let animal">
        {{ animal.birthDate | age }}
      </td>
    </ng-container>

    <!-- Sex -->
    <ng-container matColumnDef="sex">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.sex.label' | translate }}</th>
      <td mat-cell *matCellDef="let animal">
        @switch (animal.sex ) { @case ('male') {
        <mat-icon>{{ 'model.animal.sex.male_icon' | translate }}</mat-icon>
        } @case ('female') {
        <mat-icon>{{ 'model.animal.sex.female_icon' | translate }}</mat-icon>
        } @default{
        <mat-icon>{{ 'model.animal.sex.unknown_icon' | translate }}</mat-icon>
        } }
      </td>
    </ng-container>

    <!-- Intake Date -->
    <ng-container matColumnDef="intakeDate">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.intakeDate' | translate }}</th>
      <td mat-cell *matCellDef="let animal">{{ animal.intakeDate | date : dateFormat }}</td>
    </ng-container>

    <!-- Health Status -->
    <ng-container matColumnDef="healthStatus">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.healthStatus.label' | translate }}</th>
      <td mat-cell *matCellDef="let animal">
        @switch (animal.healthStatus ) { @case ('Healthy') {
        <mat-icon>{{ 'model.animal.healthStatus.healthy_icon' | translate }}</mat-icon>
        } @case ('Warning') {
        <mat-icon>{{ 'model.animal.healthStatus.warning_icon' | translate }}</mat-icon>
        } @case ('Critical') {
        <mat-icon>{{ 'model.animal.healthStatus.critical_icon' | translate }}</mat-icon>
        } @default{
        <mat-icon>{{ 'model.animal.healthStatus.healthy_icon' | translate }}</mat-icon>
        } }
      </td>
    </ng-container>

    <!-- EnclosureId -->
    <ng-container matColumnDef="enclosureId">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.enclosureId' | translate }}</th>
      <td mat-cell *matCellDef="let animal">
        <button
          matIconButton
          data-cy="btn-enclosureId"
          [routerLink]="['/enclosures', animal.enclosureId]"
        >
          <mat-icon>arrow_forward</mat-icon>
          <!--
        {{ dataService.findShelter(animal.enclosureId)!.id }}
         -->
        </button>
      </td>
    </ng-container>

    <!-- Photos -->
    <ng-container matColumnDef="photos">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.photos' | translate }}</th>
      <td mat-cell *matCellDef="let animal">{{ animal.photos }}</td>
    </ng-container>

    <!-- Adoptable -->
    <ng-container matColumnDef="adoptable">
      <th mat-header-cell *matHeaderCellDef>{{ 'model.animal.adoptable' | translate }}</th>
      <td mat-cell *matCellDef="let animal">
        @if(animal.adoptable) {
        <mat-icon>{{ 'model.animal.adoptable_true_icon' | translate }}</mat-icon>
        } @else {
        <mat-icon>{{ 'model.animal.adoptable_false_icon' | translate }}</mat-icon>
        }
      </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let animal; columns: displayedColumns"></tr>
  </table>
</app-loading>
